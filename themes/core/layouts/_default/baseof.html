<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>

  {{ partial "favicon.html" . }}

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ .Permalink }}">

  <!-- RSS Feed -->
  {{ with .OutputFormats.Get "RSS" }}
    <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" href="{{ .Permalink }}">
  {{ end }}

  <!-- Pagination SEO -->
  {{ if ne .Kind "page" }}
    {{ if .Paginator }}
      {{ if .Paginator.HasPrev }}
        <link rel="prev" href="{{ .Paginator.Prev.URL | absURL }}">
      {{ end }}
      {{ if .Paginator.HasNext }}
        <link rel="next" href="{{ .Paginator.Next.URL | absURL }}">
      {{ end }}
    {{ end }}
  {{ end }}

  <!-- Meta Description with Fallback Chain -->
  {{ $description := .Description | default (.Summary | plainify | truncate 155) | default .Site.Params.description }}
  {{ with $description }}<meta name="description" content="{{ . }}">{{ end }}

  <link rel="stylesheet" href="{{ "css/main.css" | relURL }}">
  {{ if .Site.Params.darkMode }}
  <link rel="stylesheet" href="{{ "css/dark-mode.css" | relURL }}">
  {{ end }}
  <link rel="stylesheet" href="{{ "css/accessibility.css" | relURL }}">
  <link rel="stylesheet" href="{{ "css/print.css" | relURL }}" media="print">

  {{ partial "analytics.html" . }}

  {{- /* Detect social media image */ -}}
  {{ $ogImage := partial "og-image.html" . }}

  <!-- Open Graph -->
  <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
  <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
  <meta property="og:url" content="{{ .Permalink }}">
  {{ with $description }}<meta property="og:description" content="{{ . }}">{{ end }}
  {{ with .Site.Title }}<meta property="og:site_name" content="{{ . }}">{{ end }}
  {{ with $ogImage }}<meta property="og:image" content="{{ . | absURL }}">{{ end }}
  {{ if .IsPage }}{{ with .PublishDate }}<meta property="article:published_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}">{{ end }}{{ end }}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary{{ with $ogImage }}_large_image{{ end }}">
  <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
  {{ with $description }}<meta name="twitter:description" content="{{ . }}">{{ end }}
  {{ with $ogImage }}<meta name="twitter:image" content="{{ . | absURL }}">{{ end }}
  {{ with .Site.Params.twitter }}<meta name="twitter:site" content="@{{ . }}">{{ end }}

  <!-- Homepage: Last Post Update -->
  {{ if .IsHome }}
    {{ with (index .Site.RegularPages 0) }}
      <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ end }}
  {{ end }}

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{{ if .IsPage }}Article{{ else }}WebSite{{ end }}",
    {{ if .IsPage }}"headline": {{ .Title | jsonify }},{{ else }}"name": {{ .Site.Title | jsonify }},{{ end }}
    {{ if .IsPage }}"author": {
      "@type": "Person",
      "name": {{ .Site.Params.author | default "Anonymous" | jsonify }}
    },
    "datePublished": {{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" | jsonify }},
    {{ with .Lastmod }}"dateModified": {{ .Format "2006-01-02T15:04:05Z07:00" | jsonify }},{{ end }}
    {{ end }}{{ if and .IsHome (index .Site.RegularPages 0) }}{{ with (index .Site.RegularPages 0) }}"dateModified": {{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" | jsonify }},{{ end }}{{ end }}"url": {{ .Permalink | jsonify }},
    {{ with $description }}"description": {{ . | jsonify }},{{ end }}
    {{ with $ogImage }}"image": {{ . | absURL | jsonify }},{{ end }}
    "publisher": {
      "@type": "Organization",
      "name": {{ .Site.Title | jsonify }}
    }
  }
  </script>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  {{ partial "header.html" . }}

  <main id="main" role="main">
    {{ block "main" . }}{{ end }}
  </main>

  {{ partial "footer.html" . }}

  <script src="{{ "js/code-copy.js" | relURL }}"></script>
</body>
</html>
